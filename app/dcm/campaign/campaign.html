<div class="column-layout">

    <nav>
        <div class="header-row">
            <h3 translate>campaign.header</h3>
        </div>
        <div class="button-row"></div>
        <campaign-card campaign="campaign"></campaign-card>

    </nav>

    <section>

        <div class="header-row"></div>
        <div class="button-row"></div>

        <form name="campaignForm" ypModel="campaign" role="form" class="form-horizontal"
              ng-submit="saveCampaign()" novalidate>
            <div class="col-md-12">
                <div class="form-group topic">
                    <label class="control-label" translate>campaignForm.topic.label</label>

                    <p>{{campaign.topic.name |uppercase}}: {{campaign.topic.shortDescription}}
                        <a ui-sref="dcm.topics"
                           translate
                           ng-if="!campaign.id">campaignForm.topic.change</a>
                    </p>
                </div>
                <yp-input name="participants"></yp-input>
                <yp-input name="location"></yp-input>
                <yp-input name="city"></yp-input>

                <div class="form-group date">
                        <label class="control-label" translate>campaignForm.start.label</label>
                    <div class="start">
                        <date-picker date="campaign.start" future-date ng-model="campaign.start"></date-picker>
                        <date-picker date="campaign.end" future-date ng-model="campaign.end"></date-picker>
                        <label class="" translate>campaignForm.end.label</label>
                    </div>
                </div>


                <div ng-if="!campaign.id" class="payment-code">

                    <div class="form-group">
                        <label translate>campaignForm.paymentCode.label</label>

                        <div class="input-group">
                            <input ng-model="code" type="text" class="form-control" ng-change="validatePaymentCode(code)">

                            <span class="input-group-addon">
                                <span ng-show="validPaymentCode" class="glyphicon glyphicon-ok"></span>
                                <span ng-show="!validPaymentCode" class="glyphicon glyphicon-remove"></span>
                            </span>

                            <!--<span class="input-group-btn">-->
                            <!--<button class="btn btn-default" type="button" ng-click="validatePaymentCode(code)">-->
                            <!--validate-->
                            <!--</button>-->
                            <!--</span>-->
                        </div>

                    </div>

                    <div ng-if="validPaymentCode === false">

                        <span ng-if="paymentCode.status == 404" translate>campaignForm.paymentCode.invalidCode</span>
                        <span ng-if="paymentCode.status == 409" translate translate-values="{ invalidTopic: invalidTopic.name }">campaignForm.paymentCode.invalidTopic</span>

                    </div>
                </div>
            </div>
        </form>


        <div ng-show="campaign.id">
            <div class="row">
                <div class="col-md-12">
                    <h3 translate>campaign.campaignLeads.header</h3>
                </div>
            </div>
            <div class="row campaign-leads" ng-repeat="campaignLead in campaign.campaignLeads">
                <div class="col-md-1">
                    <img ng-src="{{campaignLead.avatar}}">
                </div>
                <div class="col-md-4">
                    <div>{{ campaignLead.fullname }}</div>
                </div>
                <div class="col-md-4">
                    <div>{{ campaignLead.email }}</div>
                </div>
            </div>


            <div class="row invite-campaign-lead" ng-show="formVisible">
                <div class="col-md-12">

                    <div translate ng-if="invitationSent">inviteCampaignLeadForm.invitationSent</div>

                    <form class="form-inline" ng-if="!invitationSent"
                          role="form"
                          ng-submit="inviteCampaignLeadForm.$valid && inviteCampaignLead(campaignLeads, campaign)"
                          name="inviteCampaignLeadForm">
                        <div class="form-group"
                             ng-class="{'has-error': inviteCampaignLeadForm.email.$dirty && inviteCampaignLeadForm.email.$invalid}">
                            <label class="sr-only" translate>inviteCampaignLeadForm.email.label</label>
                            <input class="form-control email-field" name="email" type="text"
                                   ng-model="campaignLeads"
                                   placeholder="{{'inviteCampaignLeadForm.email.placeholder' | translate}}"
                                   multiple-Emails required>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary"
                                    ng-disabled="inviteCampaignLeadForm.$invalid"
                                    translate>inviteCampaignLeadForm.inviteSubmit
                            </button>
                        </div>
                    </form>

                </div>
            </div>

            <button class="btn btn-default" ng-click="showForm()"
                    translate>
                campaign.campaignLeads.add
            </button>
        </div>
    </section>

    <aside>


        <div class="header-row">
            <div class="back-link" ui-sref="^.home">
                <span class="fa fa-chevron-left"></span>
                <span translate>activity.link.back</span>
            </div>
        </div>
        <div class="button-row" ng-if="(campaign.id && campaignForm.$dirty) || (!campaign.id && validPaymentCode)">
            <button ng-click="!campaignController.submitting && saveCampaign();campaignController.submitting = true" class="btn btn-primary" ng-disabled="campaignForm.$invalid" busy>
                <busy-message><i class="fa fa-cog fa-spin"></i><span translate>busy.submitting</span></busy-message>
                <span translate>campaignForm.save</span>

            </button>
                <button type="button" class="btn btn-default pull-right" ng-click="campaign.id ? $state.go('dcm.campaign',{campaignId: campaign.id}, {reload: true}) : $state.go('dcm.home')">
                    <span translate>campaignForm.cancel</span>
                </button>
        </div>



        <health-coach event="'stateEnter'"></health-coach>
    </aside>

</div>




